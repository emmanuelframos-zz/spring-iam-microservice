#!/bin/sh

./gradlew clean build -x test

docker stop $(docker ps -qa --filter="name=iam-microservice") || true

docker rm -f $(docker ps -qa --filter="name=iam-microservice") || true

docker build -t iam-microservice:latest .

docker login -u AWS -p eyJwYXlsb2FkIjoidEFMSWMxU2E2dkVnVHpVN2lNYzBrV3dyL2lSSFk2bmlUZEFTZkxaM0duNU4rMU1WdWhTQVpiYW9BbXJMZTZHLzlES0tpNUEvU2IxYkxSM3NiWTYwTmJsdWhxMlNhUDA5NGNBdUFiOG90SHNuMHJtbnJkeXdzdHB6eTkrVUE1M25YRVBoTlJYTUJHR3piUlBGOGVENms2WmVpWXB2c0laMDFhY09hVVZvV3NWQm4yUDRyS3gySlB2OHN3cVl5QTJpOUNQOEZkb2g2aWtlVmpWWExyRmlHenpDR0pWL0lORXlHMHpqSmFGNVZaZW14cnpHNG8zVkxrV0w5bzRZMkdKdUVOeSt4QVQzUTU4ekNQWlZMMy9GVWxVaGRTTVpIaWNUenNIN05HWXhOQjkwK0RDY2Zac1RtdEh0emFtbGVSbk10THlJVjJHbUNpOERsY0dvd0JZOFRKUWhvZkZGZTRHZ1hVTGdnOFAxbGwxbVZGYS9FREhMTE9neGZ2MkNWRUp5T0MrVnEzVHdwTjNXbEdMYStxR0VwZGh3TVBsQWo2akdDWHhPQlAvblppOHRMaTJFekJUL1FTMUh5OVJJWFhjMmNDNlQzWnByK2Nja3kySW93dlBsUm1OWWNEYkRHV2swaG5uQ25kSGJNVklHbWpXV2ZhYlNvbG55OHdkaHlYVlJoSGZ5ZGxPaW1vYlFUbnlTa3BCK2VOY3NhakFiYzVDUUh3WVRZQXhRaGtyak41TncyMEU2NXkyQ3RoSjBwbVFDdkJpZk5NZTZ5R1pSa216cjNIWS9sdnRlQ3lBdll6R1U1cFRKYTdSdXJ2T0JnbkdsOEtVeHJEeXdqUG9OQ0t1U0c5TlJkRmdYc3d6c2t1VldLMEdMS0JiMElqRHNtVDYwMnF4dkloYXNFM3JqUWdVOXBqNEt3OE9BT0FyRi9uWmZwOWMwazkrUmR0ZEZyVDVPSVlRTlhlZ2xHRitIdzZLZDNSWUp4N1d0c0ZzT09TUGUxekY5U3JJd0ttM0VDWkFJWmcvelpoOEZNODZiOEdSQjlpNVl2dld2QkFER05TSmwxaitmOHZqbnFqcExpK3JtMkpZYWxEV3pNVmRHSkFPRW5DWWR2Y3JQSWNIMUhsL0lOYmo0OEMvbFNZYUlsc2pZUjNKbjMrS2tDU2FRNUJnUnhnNEZ6OUcxR1FvM21obmVWV0h1MW5MN2Q3RjNMRlBiclJPdWl2TjFTUkFoSXphM044dmhuQlFIbCtsQ3AzMXIxRGp0MGRlVWRnLzJ4NXBYQ2RDUnN0OU1iRmZKWEdVOHBSSXhLdm1CUG1RU3EvcFZ6aHN5R0J3eHVYNFVXZEthL3lzci9aOHdNbzJ3cXQ0NFFpcGloWVZHM0QyM3FkYzFCaFhWTUZIOTVMcjN5RTRiZ0JPaC9kMUJkdXk0bkRXbTBNSzNUSXZzL1d4cUtYMHczdUU2eXVZK2tDemV6MnlBOXA0PSIsImRhdGFrZXkiOiJBUUVCQUhod20wWWFJU0plUnRKbTVuMUc2dXFlZWtYdW9YWFBlNVVGY2U5UnE4LzE0d0FBQUg0d2ZBWUpLb1pJaHZjTkFRY0dvRzh3YlFJQkFEQm9CZ2txaGtpRzl3MEJCd0V3SGdZSllJWklBV1VEQkFFdU1CRUVESWlHVkVWS1ZzWGpqbGhLUHdJQkVJQTdqdlhtY0JYbGxEclUzVGIrM3UwajR4b3JFUkYrL0toaWduMWt3czE4YXJGNnFBWmE0M0xOc2xEVzhQUXJ1dnJ1U2l4KytNaUFSSTJ6TFE0PSIsInZlcnNpb24iOiIyIiwidHlwZSI6IkRBVEFfS0VZIiwiZXhwaXJhdGlvbiI6MTUzMDYwODgyNX0= https://810096332563.dkr.ecr.us-east-1.amazonaws.com

docker tag iam-microservice:latest 810096332563.dkr.ecr.us-east-1.amazonaws.com/dev-associate:latest

docker push 810096332563.dkr.ecr.us-east-1.amazonaws.com/dev-associate:latest